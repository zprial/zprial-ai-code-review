# Story 1.1: Repo Integration Setup

## Status
Draft

## Story
**As a** 平台管理员,
**I want** 在配置界面或配置文件中注册 GitLab/GitHub 仓库与凭证,
**so that** 系统可以安全地监听目标仓库的 MR 事件。

## Acceptance Criteria
1. 支持注册 GitLab 和 GitHub 仓库的访问凭证，并通过测试按钮验证有效性。
2. 配置保存后，系统能订阅 MR 创建/更新事件，失败时给出错误日志。
3. 权限不足或凭证过期时产生告警并要求重新配置。

## Tasks / Subtasks
- [ ] 设计并实现仓库接入配置模型（AC: 1）
  - [ ] 支持加密存储访问凭证（AC: 1）
  - [ ] 提供测试连接接口返回详细错误（AC: 1,2）
- [ ] 实现 MR 事件订阅与回调处理流程（AC: 2）
  - [ ] 为 GitLab/GitHub 分别配置 webhook/应用订阅（AC: 2）
  - [ ] 记录失败事件并输出结构化日志（AC: 2）
- [ ] 构建凭证健康检测与告警机制（AC: 3）
  - [ ] 定期校验凭证有效性并触发告警（AC: 3）
  - [ ] 在 UI/配置文件中突出显示需要更新的凭证（AC: 3）

## Dev Notes
- 参考 PRD 中对 GitLab/GitHub 集成的要求，确保初期支持这两类仓库。
- 配置数据建议持久化于平台统一配置存储（如 PostgreSQL），并利用密钥管理服务进行加密。
- Webhook 端点需兼容未来扩展到其他代码托管平台。

### Testing
- 编写单元测试覆盖配置模型校验与凭证加密/解密逻辑。
- 编写集成测试模拟 GitLab/GitHub webhook 调用，验证订阅与失败日志输出。
- 若引入定时健康检查，补充对应的调度任务测试或回放脚本。

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-18 | 0.1 | 初始草稿 | PO Sarah |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

