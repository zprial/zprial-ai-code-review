# Story 2.2: Graded Feedback Blocking

## Status
Draft

## Story
**As a** 开发者,
**I want** 在 MR 中看到分级评论并被阻断高风险合并,
**so that** 可以快速定位并修复问题。

## Acceptance Criteria
1. 根据严重度映射输出阻断/警告/提示/确认四类评论，并引用具体行号。
2. 阻断级评论自动 @ 提交者并标记 MR 为需要变更后才能合并。
3. 评论文本包含风险说明、证据以及建议的修改方向。

## Tasks / Subtasks
- [ ] 设计评论分级与模板系统（AC: 1,3）
  - [ ] 为四个等级定义统一格式与徽标（AC: 1）
  - [ ] 模板中嵌入风险说明与建议占位符（AC: 3）
- [ ] 集成 GitLab/GitHub 评论与阻断 API（AC: 1,2）
  - [ ] 在相应行发表评论并附带代码引用（AC: 1）
  - [ ] 实现阻断级自动 @ 提交者并更新 MR 状态（AC: 2）
- [ ] 构建内容生成与验证流程（AC: 3）
  - [ ] 将审查结果映射到模板并校验完整性（AC: 3）
  - [ ] 记录评论发送结果供后续追踪（AC: 2,3）

## Dev Notes
- 参考 PRD 中四级评论标准，确保与后续报表等级字段一致。
- GitLab/GitHub 阻断机制分别为 discussions/required approvals，需要测试差异。
- 建议封装评论发送 SDK，便于未来支持更多平台。

### Testing
- 单元测试覆盖等级映射、模板渲染与参数校验。
- 集成测试对接真实或模拟 GitLab/GitHub API，验证行级评论与阻断效果。
- 针对重复评论、评论失败重试等场景编写回归用例。

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-18 | 0.1 | 初始草稿 | PO Sarah |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

