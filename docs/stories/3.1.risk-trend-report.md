# Story 3.1: Risk Trend Report

## Status
Draft

## Story
**As a** 管理层用户,
**I want** 查看周/月风险趋势与责任分布,
**so that** 可以评估质量改进效果。

## Acceptance Criteria
1. 支持按时间、仓库、严重度筛选，并展示折线/柱状图。
2. 报表可导出 CSV/JSON，字段包含时间段、问题数量、提交者、严重度。
3. 数据刷新频率可配置（默认每日），并提供最后更新时间。

## Tasks / Subtasks
- [ ] 设计并实现风险趋势查询 API（AC: 1,2,3）
  - [ ] 提供时间区间、仓库、严重度过滤参数（AC: 1）
  - [ ] 返回标准化数据集含所需字段（AC: 2）
- [ ] 构建前端可视化组件与导出功能（AC: 1,2）
  - [ ] 实现折线/柱状图切换与状态保持（AC: 1）
  - [ ] 支持 CSV/JSON 导出并验证字段完整性（AC: 2）
- [ ] 实现数据刷新计划与时间戳展示（AC: 3）
  - [ ] 可配置刷新周期并存储最后刷新时间（AC: 3）
  - [ ] 在界面显著位置展示更新时间（AC: 3）

## Dev Notes
- 数据来源为审查结果存储，需确保分类字段与评论等级匹配；查询/缓存逻辑参考 `docs/architecture.md:199-233`。
- 前端视觉与交互遵循 `docs/front-end-spec.md:168-212`，图表可使用公司统一图表库或 ECharts/Ant Design Charts。
- 刷新策略需考虑数据量，初期可采用每日批处理，并在 Runbook 中同步刷新步骤（`docs/runbook.md:23-38`）。

### Testing
- 单元测试覆盖过滤参数处理、导出数据格式化逻辑。
- 前端组件编写快照/交互测试，验证筛选与导出。
- 集成测试确保刷新计划按配置执行，并更新最后时间戳。

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-18 | 0.1 | 初始草稿 | PO Sarah |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
