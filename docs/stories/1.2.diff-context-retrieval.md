# Story 1.2: Diff Context Retrieval

## Status
Draft

## Story
**As a** 审查服务,
**I want** 在触发后抓取 MR 改动及一到两层关联文件,
**so that** AI 审查可以获得足够的上下文信息。

## Acceptance Criteria
1. 能够列出改动文件，并对每个文件提取完整内容与差异。
2. 支持根据 import/调用关系额外拉取一层到两层关联文件，且可配置最大范围。
3. 解析结果以结构化数据形式存储，供审查引擎消费。

## Tasks / Subtasks
- [ ] 实现改动文件解析与内容提取模块（AC: 1）
  - [ ] 支持多语言文件差异解析策略（AC: 1）
  - [ ] 处理大文件时的分页或截断逻辑（AC: 1）
- [ ] 构建关联文件发现与拉取能力（AC: 2）
  - [ ] 基于 import/调用关系递归一到两层（AC: 2）
  - [ ] 提供可配置的最大文件数与深度限制（AC: 2）
- [ ] 将解析数据标准化并存储供后续使用（AC: 3）
  - [ ] 定义统一的数据结构/模式（AC: 3）
  - [ ] 编写接口供审查引擎检索数据（AC: 3）

## Dev Notes
- 可利用现有 Git 平台 API 或 git diff 命令获取改动差异。
- 关联文件解析需考虑常见语言（TS/JS、Python 等）的导入语法，预留扩展点。
- 存储格式建议 JSON/BSON 文档或结构化表，以便 AI 引擎快速读取。

### Testing
- 单元测试覆盖差异解析、关联文件选择及配置边界条件。
- 集成测试模拟含多文件、多语言 MR，验证深度限制与数据存储正确性。
- 针对大文件与循环依赖编写回归用例。

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-18 | 0.1 | 初始草稿 | PO Sarah |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

