# Story 2.3: Dingding Escalation

## Status
Draft

## Story
**As a** 工程经理,
**I want** 对长期未解决的阻断问题收到钉钉提醒,
**so that** 可以及时推进整改。

## Acceptance Criteria
1. 支持配置通知群、@ 责任人名单及阈值时间（如 24 小时）。
2. 当阻断问题超过阈值未关闭时，自动发送钉钉卡片通知并附带问题详情。
3. 通知发送失败时产生日志并允许重试。

## Tasks / Subtasks
- [ ] 构建钉钉通知配置与管理接口（AC: 1）
  - [ ] 支持配置群聊 Webhook、责任人列表与时限（AC: 1）
  - [ ] 验证配置合法性并提示错误（AC: 1）
- [ ] 实现阻断问题逾期检测与通知生成（AC: 2）
  - [ ] 扫描阻断评论状态与时间戳（AC: 2）
  - [ ] 生成包含问题详情、链接和建议的钉钉卡片（AC: 2）
- [ ] 处理通知失败与重试机制（AC: 3）
  - [ ] 记录失败原因并触发重试/人工干预（AC: 3）
  - [ ] 暴露告警供运维监控（AC: 3）

## Dev Notes
- 使用企业钉钉机器人接口，注意签名/加密要求；参考 `docs/architecture.md:166-173` 的集成说明。
- 阈值计算需与审查任务队列时间保持一致，避免重复提醒；相关告警策略见 `docs/runbook.md:66-88`。
- 通知内容应与评论等级体系对齐，视觉样式参考 `docs/front-end-spec.md#notifications` 的通知卡片设计。

### Testing
- 单元测试覆盖配置校验、阈值比较、通知内容生成。
- 集成测试模拟钉钉 Webhook 接收，验证成功与失败重试流程。
- 写入回归测试确保多阻断项时的批量通知不会遗漏。

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-18 | 0.1 | 初始草稿 | PO Sarah |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
